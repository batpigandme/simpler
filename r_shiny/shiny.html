<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Starting Out with R and Shiny</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="This is a booklike set of lesson plans on starting out with R, with the goal of writing Shiny dashboards.">
  <meta name="generator" content="bookdown 0.0.72 and GitBook 2.6.7">

  <meta property="og:title" content="Starting Out with R and Shiny" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a booklike set of lesson plans on starting out with R, with the goal of writing Shiny dashboards." />
  <meta name="github-repo" content="ironholds/simpler" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Starting Out with R and Shiny" />
  
  <meta name="twitter:description" content="This is a booklike set of lesson plans on starting out with R, with the goal of writing Shiny dashboards." />
  

<meta name="author" content="Oliver Keyes">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="cleaning-and-manipulating-data.html">


<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://github.com/ironholds/simpler">Starting Out with R and Shiny</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preamble</a></li>
<li class="chapter" data-level="1" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i><b>1</b> Introduction to R</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#a-brief-history-of-splines"><i class="fa fa-check"></i><b>1.1</b> A brief history of splines</a></li>
<li class="chapter" data-level="1.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#why-r-succeeds"><i class="fa fa-check"></i><b>1.2</b> Why R succeeds</a></li>
<li class="chapter" data-level="1.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#the-r-community"><i class="fa fa-check"></i><b>1.3</b> The R community</a></li>
<li class="chapter" data-level="1.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-installation"><i class="fa fa-check"></i><b>1.4</b> R installation</a></li>
<li class="chapter" data-level="1.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#using-rstudio"><i class="fa fa-check"></i><b>1.5</b> Using RStudio</a></li>
<li class="chapter" data-level="1.6" data-path="introduction-to-r.html"><a href="introduction-to-r.html#tutorial-format"><i class="fa fa-check"></i><b>1.6</b> Tutorial format</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-import-and-export.html"><a href="data-import-and-export.html"><i class="fa fa-check"></i><b>2</b> Data Import and Export</a><ul>
<li class="chapter" data-level="2.1" data-path="data-import-and-export.html"><a href="data-import-and-export.html#importing-from-csvs"><i class="fa fa-check"></i><b>2.1</b> Importing from CSVs</a></li>
<li class="chapter" data-level="2.2" data-path="data-import-and-export.html"><a href="data-import-and-export.html#importing-excel-spreadsheets"><i class="fa fa-check"></i><b>2.2</b> Importing Excel spreadsheets</a></li>
<li class="chapter" data-level="2.3" data-path="data-import-and-export.html"><a href="data-import-and-export.html#other-files"><i class="fa fa-check"></i><b>2.3</b> Other files</a></li>
<li class="chapter" data-level="2.4" data-path="data-import-and-export.html"><a href="data-import-and-export.html#database-import"><i class="fa fa-check"></i><b>2.4</b> Database import</a></li>
<li class="chapter" data-level="2.5" data-path="data-import-and-export.html"><a href="data-import-and-export.html#exporting-data"><i class="fa fa-check"></i><b>2.5</b> Exporting data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>3</b> Exploratory Data Analysis</a><ul>
<li class="chapter" data-level="3.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#dataset-metadata"><i class="fa fa-check"></i><b>3.1</b> Dataset metadata</a></li>
<li class="chapter" data-level="3.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#missing-and-duplicate-values"><i class="fa fa-check"></i><b>3.2</b> Missing and duplicate values</a></li>
<li class="chapter" data-level="3.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#examining-values"><i class="fa fa-check"></i><b>3.3</b> Examining values</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cleaning-and-manipulating-data.html"><a href="cleaning-and-manipulating-data.html"><i class="fa fa-check"></i><b>4</b> Cleaning and manipulating data</a><ul>
<li class="chapter" data-level="4.1" data-path="cleaning-and-manipulating-data.html"><a href="cleaning-and-manipulating-data.html#reshaping-data"><i class="fa fa-check"></i><b>4.1</b> Reshaping data</a></li>
<li class="chapter" data-level="4.2" data-path="cleaning-and-manipulating-data.html"><a href="cleaning-and-manipulating-data.html#data-manipulation"><i class="fa fa-check"></i><b>4.2</b> Data manipulation</a></li>
<li class="chapter" data-level="4.3" data-path="cleaning-and-manipulating-data.html"><a href="cleaning-and-manipulating-data.html#text-cleaning"><i class="fa fa-check"></i><b>4.3</b> Text-cleaning</a></li>
<li class="chapter" data-level="4.4" data-path="cleaning-and-manipulating-data.html"><a href="cleaning-and-manipulating-data.html#dates-and-times"><i class="fa fa-check"></i><b>4.4</b> Dates and times</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="shiny.html"><a href="shiny.html"><i class="fa fa-check"></i><b>5</b> Shiny</a><ul>
<li class="chapter" data-level="5.1" data-path="shiny.html"><a href="shiny.html#building-your-first-app"><i class="fa fa-check"></i><b>5.1</b> Building your first app</a></li>
<li class="chapter" data-level="5.2" data-path="shiny.html"><a href="shiny.html#user-interface-design"><i class="fa fa-check"></i><b>5.2</b> User Interface design</a></li>
<li class="chapter" data-level="5.3" data-path="shiny.html"><a href="shiny.html#custom-inputs-and-outputs"><i class="fa fa-check"></i><b>5.3</b> Custom inputs and outputs</a></li>
<li class="chapter" data-level="5.4" data-path="shiny.html"><a href="shiny.html#optimising-dashboards"><i class="fa fa-check"></i><b>5.4</b> Optimising dashboards</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Starting Out with R and Shiny</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="shiny" class="section level1">
<h1><span class="header-section-number">5</span> Shiny</h1>
<p>It’s now time to dig into Shiny - a system to build (amongst of things) web dashboards in R. By the end of this tutorial you’ll hopefully have everything you need to build them yourselves.</p>
<div id="building-your-first-app" class="section level2">
<h2><span class="header-section-number">5.1</span> Building your first app</h2>
<p>This is the code behind a Shiny app. Run it on your machine and see what it looks like!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(shinydashboard)
<span class="kw">library</span>(shiny)

ui &lt;-<span class="st"> </span><span class="kw">dashboardPage</span>(
  <span class="kw">dashboardHeader</span>(<span class="dt">title =</span> <span class="st">&quot;A simple dashboard&quot;</span>),
  <span class="kw">dashboardSidebar</span>(),
  <span class="kw">dashboardBody</span>(
    <span class="kw">fluidRow</span>(
      <span class="kw">box</span>(<span class="kw">plotOutput</span>(<span class="st">&quot;first_plot&quot;</span>, <span class="dt">height =</span> <span class="dv">250</span>)),

      <span class="kw">box</span>(
        <span class="dt">title =</span> <span class="st">&quot;Controls&quot;</span>,
        <span class="kw">sliderInput</span>(<span class="st">&quot;slider&quot;</span>, <span class="st">&quot;Number of observations:&quot;</span>, <span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">50</span>)
      )
    )
  )
)

server &lt;-<span class="st"> </span>function(input, output) {
  histdata &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">500</span>)

  output$first_plot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({
    data &lt;-<span class="st"> </span>histdata[<span class="kw">sample</span>(input$slider)]
    <span class="kw">hist</span>(data)
  })
}

<span class="kw">shinyApp</span>(ui, server)</code></pre></div>
<p>So let’s break down what’s happening in the code. We have two main components: <code>ui</code> and <code>server</code>. <code>ui</code> contains, well, the user interface: the title of the page, how the page is formatted, what it contains (in this case, a box of plot output, which is the histogram, and a box of controls - the slider you see).</p>
<p><code>ui</code> objects have three mandatory components. The first is <code>dashboardHeader</code>, the title bar. The second is <code>dashboardSidebar</code>, the, well, sidebar: when you have multiple tabs, it’s where you’ll identify each tab and how to represent it. Finally, we have <code>dashboardBody</code>, which contains the code to actually display plots or other dashboard elements, and control how those elements <em>should</em> be displayed.</p>
<p><code>server</code> contains the actual number-crunching and dashboard generation. It’s a function that takes two arguments, <code>input</code> and <code>output</code>: <code>input</code> contains the values of any user-facing controls, while <code>output</code> is used to store rendered plots or text elements or whatever you’re displaying. We can see how this comes together in our example: <code>ui</code> has a <code>plotOutput</code> named “first_plot”, and a <code>sliderInput</code> called “slider”. <code>server</code> uses the slider input (at <code>input$slider</code>) to generate a plot (at <code>output$first_plot</code>), and the result is a nice controllable visualisation displayed for the world to see.</p>
</div>
<div id="user-interface-design" class="section level2">
<h2><span class="header-section-number">5.2</span> User Interface design</h2>
<p>One of the nice things about Shiny dashboards is that you can tweak their UIs to make them distinctive and fit into a more general colour scheme. A simple example, obviously, is modifying the <code>title</code> in <code>dashboardHeader</code>, but we can also change the overall skin and theme by adding <code>skin = [name_of_skin]</code> to <code>dashboardPage</code>: options are “blue”, “black”, “purple”, “green”, “red” and “yellow”. Let’s try it now:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(shinydashboard)
<span class="kw">library</span>(shiny)

ui &lt;-<span class="st"> </span><span class="kw">dashboardPage</span>(
  <span class="dt">skin =</span> <span class="st">&quot;yellow&quot;</span>,
  <span class="kw">dashboardHeader</span>(<span class="dt">title =</span> <span class="st">&quot;A simple dashboard with a custom title&quot;</span>),
  <span class="kw">dashboardSidebar</span>(),
  <span class="kw">dashboardBody</span>(
    <span class="kw">fluidRow</span>(
      <span class="kw">box</span>(<span class="kw">plotOutput</span>(<span class="st">&quot;first_plot&quot;</span>, <span class="dt">height =</span> <span class="dv">250</span>)),

      <span class="kw">box</span>(
        <span class="dt">title =</span> <span class="st">&quot;Controls&quot;</span>,
        <span class="kw">sliderInput</span>(<span class="st">&quot;slider&quot;</span>, <span class="st">&quot;Number of observations:&quot;</span>, <span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">50</span>)
      )
    )
  )
)

server &lt;-<span class="st"> </span>function(input, output) {
  histdata &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">500</span>)

  output$first_plot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({
    data &lt;-<span class="st"> </span>histdata[<span class="kw">sample</span>(input$slider)]
    <span class="kw">hist</span>(data)
  })
}

<span class="kw">shinyApp</span>(ui, server)</code></pre></div>
<p>I’ll be honest and say that “congealed cheez-whiz orange” isn’t my ideal colour, but there are other options to pick from. Beyond that, if you want to make big or small tweaks (and you’re interested in UI and website design) you can include custom CSS, as demonstrated <a href="https://rstudio.github.io/shinydashboard/appearance.html">here</a>.</p>
</div>
<div id="custom-inputs-and-outputs" class="section level2">
<h2><span class="header-section-number">5.3</span> Custom inputs and outputs</h2>
<p>So we’ve got our basic dashboard, and we’ve tinkered with it to give it a nice title and maybe a custom theme. Next we should probably give it real data, and experiment with customising the input and output (and adding multiple tabs.</p>
<p>Let’s start with integrating the patient data, since we’re familiar with that, and build a dashboard that:</p>
<ol style="list-style-type: decimal">
<li>Reads in the patient data;</li>
<li>Generates two histograms, one for admissions and one for releases, in different tabs;</li>
<li>Lets a user select different years (and adjusts the dashboard accordingly).</li>
</ol>
<p>We already know how to read in the patient data, so that’s easy; we’ll just put that in the <code>server</code> function definition. It’ll run once when the dashboard is launched, and then just sit there waiting to be used. After that, though, we have to actually generate the plots.</p>
<p>For that we use <code>renderPlot</code>, which runs whatever code you put in it and then returns the result (expecting it to be, well, a plot!)</p>
<p>So for a simple histogram of admissions data, we replace the contents of <code>server</code> with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="dt">file =</span> <span class="st">&quot;https://www.ironholds.org/resources/misc/patient_data.csv&quot;</span>)
output$admissions_plot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({
  <span class="kw">hist</span>(patient_data$admitted)
})</code></pre></div>
<p>And done. The release plot looks pretty much the same (although we’d presumably call it, say, <code>release_plot</code>).</p>
<p>(pay attention to the <code>admissions_plot</code> name. That’ll be relevant later)</p>
<p>Selecting the years is the next bit. As we’ve seen, a slider in the dashboard’s UI can provide a value to be plugged into the calculations that generate the plot; we can also use dropdown selectors, which are more relevant here, with <code>selectInput</code>. So let’s assume the existence of a dropdown - we’ll actually define it slightly later - called <code>admissions_selector</code>, and use that to subset the data we give to the plotting function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="dt">file =</span> <span class="st">&quot;https://www.ironholds.org/resources/misc/patient_data.csv&quot;</span>)
output$admissions_plot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({
  admissions_data &lt;-<span class="st"> </span>patient_data[patient_data$year ==<span class="st"> </span>input$admissions_selector,]
  <span class="kw">hist</span>(admissions_data$admitted)
})</code></pre></div>
<p>And there we have it. The use of a slider, or selector, or any other user-inputted information to dynamically adjust the dashboard, is referred to as <em>reactivity</em>: the expressions that do so, <em>reactive expressions</em>. Useful to know for debugging or googling for help!</p>
<p>Defining multiple tabs is the next bit. As mentioned, this is controlled through both <code>dashboardSidebar</code> and <code>dashboardBody</code>: the sidebar says “there is a tab, and it’s called X”, the body says “and the contents of X are…”. So we can define multiple tabs (which we’ll call <code>admitted_hist</code> and <code>released_hist</code> for simplicity) by replacing <code>dashboardSidebar()</code> with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dashboardSidebar</span>(
  <span class="kw">sidebarMenu</span>(
    <span class="kw">menuItem</span>(<span class="dt">text =</span> <span class="st">&quot;Patient admissions&quot;</span>, <span class="dt">tabName =</span> <span class="st">&quot;admitted_hist&quot;</span>),
    <span class="kw">menuItem</span>(<span class="dt">text =</span> <span class="st">&quot;Patient releases&quot;</span>, <span class="dt">tabName =</span> <span class="st">&quot;released_hist&quot;</span>)
  )
)</code></pre></div>
<p>So this creates a sidebar, with a menu, featuring two tabs. if you include it in one of the dashboard examples above, you’ll see that the <code>text</code> argument is what’s actually displayed: the <code>tabName</code> lets us match sidebar entries with actual dashboard bodies.</p>
<p>On that note, let’s make the dashboard bodies, using our initial example. We know that we need two tabs, each with their own sliders and plots, and we also know the names of those sliders and plots. So, adapting the example we had of a Shiny dashboard right at the beginning of the section (but using <code>tabItem</code> instead of <code>fluidRow</code>, because we’re making distinct tabs), the dashboard body looks like:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dashboardBody</span>(
  <span class="kw">tabItems</span>(
    <span class="kw">tabItem</span>(<span class="dt">tabName =</span> <span class="st">&quot;admitted_hist&quot;</span>,
      <span class="kw">box</span>(<span class="kw">plotOutput</span>(<span class="st">&quot;admissions_plot&quot;</span>, <span class="dt">height =</span> <span class="dv">250</span>)),
      <span class="kw">box</span>(
          <span class="dt">title =</span> <span class="st">&quot;Controls&quot;</span>,
          <span class="kw">selectInput</span>(<span class="dt">inputId =</span> <span class="st">&quot;admissions_selector&quot;</span>,
                      <span class="dt">label =</span> <span class="st">&quot;Year:&quot;</span>,
                      <span class="dt">choices =</span> <span class="kw">c</span>(<span class="dv">2009</span>, <span class="dv">2010</span>, <span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>, <span class="dv">2014</span>)
        )
      )
    ),
    <span class="kw">tabItem</span>(<span class="dt">tabName =</span> <span class="st">&quot;released_hist&quot;</span>,
      <span class="kw">box</span>(<span class="kw">plotOutput</span>(<span class="st">&quot;released_plot&quot;</span>, <span class="dt">height =</span> <span class="dv">250</span>)),
      <span class="kw">box</span>(
          <span class="dt">title =</span> <span class="st">&quot;Controls&quot;</span>,
          <span class="kw">selectInput</span>(<span class="dt">inputId =</span> <span class="st">&quot;released_selector&quot;</span>,
                      <span class="dt">label =</span> <span class="st">&quot;Year:&quot;</span>,
                      <span class="dt">choices =</span> <span class="kw">c</span>(<span class="dv">2009</span>, <span class="dv">2010</span>, <span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>, <span class="dv">2014</span>)
        )
      )
    )
  )
)</code></pre></div>
<p>And when we put it all together:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(shinydashboard)
<span class="kw">library</span>(shiny)
<span class="kw">library</span>(readr)

<span class="co"># The UI</span>
ui &lt;-<span class="st"> </span><span class="kw">dashboardPage</span>(
  <span class="dt">skin =</span> <span class="st">&quot;black&quot;</span>,
  <span class="kw">dashboardHeader</span>(<span class="dt">title =</span> <span class="st">&quot;Admission and release data&quot;</span>),
  <span class="kw">dashboardSidebar</span>(
    <span class="kw">sidebarMenu</span>(
      <span class="kw">menuItem</span>(<span class="dt">text =</span> <span class="st">&quot;Patient admissions&quot;</span>, <span class="dt">tabName =</span> <span class="st">&quot;admitted_hist&quot;</span>),
      <span class="kw">menuItem</span>(<span class="dt">text =</span> <span class="st">&quot;Patient releases&quot;</span>, <span class="dt">tabName =</span> <span class="st">&quot;released_hist&quot;</span>)
    )
  ),
  
  <span class="co"># The body of the UI</span>
  <span class="kw">dashboardBody</span>(
    <span class="kw">tabItems</span>(
      <span class="co"># Admissions tab</span>
      <span class="kw">tabItem</span>(<span class="dt">tabName =</span> <span class="st">&quot;admitted_hist&quot;</span>,
        <span class="kw">box</span>(<span class="kw">plotOutput</span>(<span class="st">&quot;admissions_plot&quot;</span>, <span class="dt">height =</span> <span class="dv">250</span>)),
        <span class="kw">box</span>(
            <span class="dt">title =</span> <span class="st">&quot;Controls&quot;</span>,
            <span class="kw">selectInput</span>(<span class="dt">inputId =</span> <span class="st">&quot;admissions_selector&quot;</span>,
                        <span class="dt">label =</span> <span class="st">&quot;Year:&quot;</span>,
                        <span class="dt">choices =</span> <span class="kw">c</span>(<span class="dv">2009</span>, <span class="dv">2010</span>, <span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>, <span class="dv">2014</span>)
          )
        )
      ),
      <span class="co"># Releases tab</span>
      <span class="kw">tabItem</span>(<span class="dt">tabName =</span> <span class="st">&quot;released_hist&quot;</span>,
        <span class="kw">box</span>(<span class="kw">plotOutput</span>(<span class="st">&quot;released_plot&quot;</span>, <span class="dt">height =</span> <span class="dv">250</span>)),
        <span class="kw">box</span>(
            <span class="dt">title =</span> <span class="st">&quot;Controls&quot;</span>,
            <span class="kw">selectInput</span>(<span class="dt">inputId =</span> <span class="st">&quot;released_selector&quot;</span>,
                        <span class="dt">label =</span> <span class="st">&quot;Year:&quot;</span>,
                        <span class="dt">choices =</span> <span class="kw">c</span>(<span class="dv">2009</span>, <span class="dv">2010</span>, <span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>, <span class="dv">2014</span>)
          )
        )
      )
    )
  )
)

<span class="co"># The calculations behind the scenes</span>
server &lt;-<span class="st"> </span>function(input, output) {
  
  <span class="co"># Read in the file</span>
  patient_data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="dt">file =</span> <span class="st">&quot;https://www.ironholds.org/resources/misc/patient_data.csv&quot;</span>)
  
  <span class="co"># Generate the admissions plot</span>
  output$admissions_plot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({
    admissions_data &lt;-<span class="st"> </span>patient_data[patient_data$year ==<span class="st"> </span>input$admissions_selector,]
    <span class="kw">hist</span>(admissions_data$admitted)
  })
  
  <span class="co"># Generate the released plot</span>
  output$released_plot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({
    admissions_data &lt;-<span class="st"> </span>patient_data[patient_data$year ==<span class="st"> </span>input$released_selector,]
    <span class="kw">hist</span>(admissions_data$released)
  })
}

<span class="kw">shinyApp</span>(ui, server)</code></pre></div>
<p>These are very basic plots, and there are certainly prettier ways of visualising and displaying data in Shiny dashboards. If you’re interested in exploring that side of things, I’d recommend checking out:</p>
<ol style="list-style-type: decimal">
<li>The Harvard University guide to <a href="http://tutorials.iq.harvard.edu/R/Rgraphics/Rgraphics.html">building pretty, customisable plots with ggplot2</a>;</li>
<li>The <a href="https://rstudio.github.io/dygraphs/shiny.html">dygraph package</a> for interactive visualisations that can be built into Shiny dashboards;</li>
<li>Further tutorials on Shiny and various visualisation library integrations with it on the <a href="http://shiny.rstudio.com/articles/">RStudio Shiny index</a></li>
</ol>
</div>
<div id="optimising-dashboards" class="section level2">
<h2><span class="header-section-number">5.4</span> Optimising dashboards</h2>
<p>Before we move on to experimenting with tying all of this material on reading, exploration, cleaning and dashboarding together, there are a couple of ways to optimise shiny dashboards which are worth talking about if you intend to use them on more than your laptop.</p>
<p>The first is about speed; we want dashboards to load quickly for the people using them. One thing about Shiny is that every time a new user opens the dashboard up in their browser, the <code>server</code> function is re-run to make sure that the user is presented with a fresh, squeaky-clean version of the dashboard.</p>
<p>The problem is that we’re reading data in there. And over the internet, at that! It makes for a noticeable pause in the dashboard showing up, one that will get worse if we end up relying on multiple files or even database queries.</p>
<p>A partial solution is to move the call to <code>read_csv</code> out of <code>server</code>, so we end up with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Read in the file</span>
patient_data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="dt">file =</span> <span class="st">&quot;https://www.ironholds.org/resources/misc/patient_data.csv&quot;</span>)

server &lt;-<span class="st"> </span>function(input, output) {
  
  <span class="co"># Generate the admissions plot</span>
  output$admissions_plot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({
    admissions_data &lt;-<span class="st"> </span>patient_data[patient_data$year ==<span class="st"> </span>input$admissions_selector,]
    <span class="kw">hist</span>(admissions_data$admitted)
  })
  
  <span class="co"># Generate the released plot</span>
  output$released_plot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({
    admissions_data &lt;-<span class="st"> </span>patient_data[patient_data$year ==<span class="st"> </span>input$released_selector,]
    <span class="kw">hist</span>(admissions_data$released)
  })
}</code></pre></div>
<p>This solves the problem, but moves us too far in the other direction: now the data is only read in once when the dashboard is spun up. What if your data is changing, because you’re relying on (say) daily-updated data?</p>
<p>The solution is to have <code>server</code> check to see if the data needs updating, and update it if so, but leave it otherwise. That way it will (once a day, in this example) be slow, for one user, once, but be pretty speedy for everyone else and let us keep the dataset up to date. One way of achieving this is:</p>
<ol style="list-style-type: decimal">
<li>When we spin up, note the date and read in the file.</li>
<li>Every time <code>server</code> is run, have it check the current date against the stored date.</li>
<li>If the current date is greater, replace the stored date (and stored file) with new copies.</li>
</ol>
<p>This looks like:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Read in the file, and store the date</span>
patient_data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="dt">file =</span> <span class="st">&quot;https://www.ironholds.org/resources/misc/patient_data.csv&quot;</span>)
stored_date &lt;-<span class="st"> </span><span class="kw">Sys.Date</span>()

server &lt;-<span class="st"> </span>function(input, output) {
  
  <span class="co"># Check the stored date, update the date and file if we need to</span>
  if(<span class="kw">Sys.Date</span>() &gt;<span class="st"> </span>stored_date){
    patient_data &lt;&lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="dt">file =</span> <span class="st">&quot;https://www.ironholds.org/resources/misc/patient_data.csv&quot;</span>)
    stored_date &lt;&lt;-<span class="st"> </span><span class="kw">Sys.Date</span>()
  }
  
  <span class="co"># Generate the admissions plot</span>
  output$admissions_plot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({
    admissions_data &lt;-<span class="st"> </span>patient_data[patient_data$year ==<span class="st"> </span>input$admissions_selector,]
    <span class="kw">hist</span>(admissions_data$admitted)
  })
  
  <span class="co"># Generate the released plot</span>
  output$released_plot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({
    admissions_data &lt;-<span class="st"> </span>patient_data[patient_data$year ==<span class="st"> </span>input$released_selector,]
    <span class="kw">hist</span>(admissions_data$released)
  })
}</code></pre></div>
<p><code>&lt;&lt;-</code> is a new operator in this course; what it does is tells R that instead of assigning the result of a calculation inside the ‘scope’ of whatever function the calculation was made in, it should assign the result to the ‘global’ scope - ensuring that the assigned object is not deleted when the function is done, like objects inside functions usually are, and that as a consequence we can refer back to them.</p>
<p>Our second bit of optimisation is optimising for changing data. This dataset only has data from 2009 to 2014, but at some point that’s going to change, and if we leave hard-coded <code>selectInput</code> choices (<code>c(2009, 2010, ...)</code>) lying around nobody will be able to access the new information.</p>
<p>Instead, let’s populate the choices based on the data itself. Shifting the file-reading to sit above <code>ui</code>, just for consistency’s sake, we can change <code>choices = c(2009, 2010, 2011, 2012, 2013, 2014)</code> to <code>choices = unique(patient_data$year)</code>. That way it will automatically adjust to the choices that incoming data actually contains.</p>
<p>That’s it for now. If you’re reading this and part of the course this material was written for, we’re going to tie everything together using an internal dataset shortly. If you’re not, have fun exploring the many other things R (and Shiny!) can do - and feel free to <a href="mailto:ironholds@gmail.com">email me</a> if you have questions, problems or thoughts.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="cleaning-and-manipulating-data.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>


<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ironholds/simpler",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
