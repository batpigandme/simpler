<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Starting Out with R and Shiny</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="This is a booklike set of lesson plans on starting out with R, with the goal of writing Shiny dashboards.">
  <meta name="generator" content="bookdown 0.0.72 and GitBook 2.6.7">

  <meta property="og:title" content="Starting Out with R and Shiny" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a booklike set of lesson plans on starting out with R, with the goal of writing Shiny dashboards." />
  <meta name="github-repo" content="ironholds/simpler" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Starting Out with R and Shiny" />
  
  <meta name="twitter:description" content="This is a booklike set of lesson plans on starting out with R, with the goal of writing Shiny dashboards." />
  

<meta name="author" content="Oliver Keyes">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="tutorial-format.html">
<link rel="next" href="reading-data-from-databases.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preamble</a></li>
<li class="part"><span><b>Introduction to R</b></span></li>
<li class="chapter" data-level="1" data-path="background.html"><a href="background.html"><i class="fa fa-check"></i><b>1</b> Background</a><ul>
<li class="chapter" data-level="1.1" data-path="background.html"><a href="background.html#a-brief-history-of-splines"><i class="fa fa-check"></i><b>1.1</b> A brief history of splines</a></li>
<li class="chapter" data-level="1.2" data-path="background.html"><a href="background.html#why-r-succeeds"><i class="fa fa-check"></i><b>1.2</b> Why R succeeds</a></li>
<li class="chapter" data-level="1.3" data-path="background.html"><a href="background.html#the-r-community"><i class="fa fa-check"></i><b>1.3</b> The R community</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-set-up.html"><a href="getting-set-up.html"><i class="fa fa-check"></i><b>2</b> Getting set up</a><ul>
<li class="chapter" data-level="2.1" data-path="getting-set-up.html"><a href="getting-set-up.html#installation"><i class="fa fa-check"></i><b>2.1</b> Installation</a></li>
<li class="chapter" data-level="2.2" data-path="getting-set-up.html"><a href="getting-set-up.html#using-rstudio"><i class="fa fa-check"></i><b>2.2</b> Using RStudio</a></li>
</ul></li>
<li class="part"><span><b>Data Import and Export</b></span></li>
<li class="chapter" data-level="3" data-path="tutorial-format.html"><a href="tutorial-format.html"><i class="fa fa-check"></i><b>3</b> Tutorial format</a></li>
<li class="chapter" data-level="4" data-path="reading-data-from-files.html"><a href="reading-data-from-files.html"><i class="fa fa-check"></i><b>4</b> Reading data from files</a><ul>
<li class="chapter" data-level="4.1" data-path="reading-data-from-files.html"><a href="reading-data-from-files.html#csv-tsv"><i class="fa fa-check"></i><b>4.1</b> CSV &amp; TSV</a></li>
<li class="chapter" data-level="4.2" data-path="reading-data-from-files.html"><a href="reading-data-from-files.html#excel"><i class="fa fa-check"></i><b>4.2</b> Excel</a></li>
<li class="chapter" data-level="4.3" data-path="reading-data-from-files.html"><a href="reading-data-from-files.html#other-files"><i class="fa fa-check"></i><b>4.3</b> Other files</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="reading-data-from-databases.html"><a href="reading-data-from-databases.html"><i class="fa fa-check"></i><b>5</b> Reading data from databases</a></li>
<li class="chapter" data-level="6" data-path="exporting-data.html"><a href="exporting-data.html"><i class="fa fa-check"></i><b>6</b> Exporting data</a></li>
<li class="part"><span><b>Cleaning Data</b></span></li>
<li class="chapter" data-level="7" data-path="reshaping-data.html"><a href="reshaping-data.html"><i class="fa fa-check"></i><b>7</b> Reshaping data</a></li>
<li class="chapter" data-level="8" data-path="data-manipulation.html"><a href="data-manipulation.html"><i class="fa fa-check"></i><b>8</b> Data manipulation</a></li>
<li class="chapter" data-level="9" data-path="text-cleaning.html"><a href="text-cleaning.html"><i class="fa fa-check"></i><b>9</b> Text-cleaning</a></li>
<li class="chapter" data-level="10" data-path="dates-and-times.html"><a href="dates-and-times.html"><i class="fa fa-check"></i><b>10</b> Dates and times</a></li>
<li class="part"><span><b>Shiny</b></span></li>
<li class="chapter" data-level="11" data-path="building-your-first-app.html"><a href="building-your-first-app.html"><i class="fa fa-check"></i><b>11</b> Building your first app</a></li>
<li class="chapter" data-level="12" data-path="user-interface-design.html"><a href="user-interface-design.html"><i class="fa fa-check"></i><b>12</b> User Interface design</a></li>
<li class="chapter" data-level="13" data-path="custom-inputs-and-outputs.html"><a href="custom-inputs-and-outputs.html"><i class="fa fa-check"></i><b>13</b> Custom inputs and outputs</a></li>
<li class="chapter" data-level="14" data-path="reactive-expressions.html"><a href="reactive-expressions.html"><i class="fa fa-check"></i><b>14</b> Reactive expressions</a></li>
<li class="chapter" data-level="15" data-path="shiny-dashboarding.html"><a href="shiny-dashboarding.html"><i class="fa fa-check"></i><b>15</b> Shiny dashboarding</a></li>
<li class="part"><span><b>Advanced</b></span></li>
<li class="chapter" data-level="16" data-path="code-style.html"><a href="code-style.html"><i class="fa fa-check"></i><b>16</b> Code style</a></li>
<li class="chapter" data-level="17" data-path="version-control.html"><a href="version-control.html"><i class="fa fa-check"></i><b>17</b> Version control</a></li>
<li class="chapter" data-level="18" data-path="testing-and-staging.html"><a href="testing-and-staging.html"><i class="fa fa-check"></i><b>18</b> Testing and staging</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Starting Out with R and Shiny</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="reading-data-from-files" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Reading data from files</h1>
<p>Obviously the first step in data analysis is getting the data, so let’s start there! Datasets come in lots of different formats, so we’ll cover the ones you most commonly see in a business context, namely:</p>
<ol style="list-style-type: decimal">
<li>Comma-separated and tab-separated values files (CSV/TSV);</li>
<li>Microsoft Excel spreadsheets;</li>
<li>MySQL and similar databases.</li>
</ol>
<div id="csv-tsv" class="section level2">
<h2><span class="header-section-number">4.1</span> CSV &amp; TSV</h2>
<p>CSVs and TSVs are the most common file format for data, and the good news there is that as a consequence, R has a whole host of tools for reading them in. Let’s open by loading one of them: the <code>readr</code> add-on I had you install earlier:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)</code></pre></div>
<p>So, what’s this code doing? First, <code>library</code>; that’s a function, which is a self-contained chunk of code that’s packaged and made available so you can use it as many times as you want without having to write the code out entirely each time. <code>readr</code> is the input provided to <code>library</code>. So it works out as <code>do_this_thing(to_this_thing)</code>.</p>
<p>The <code>library</code> function loads <em>packages</em> - the add-ons I was talking about earlier - so you can refer to the code they contain when you’re working. In this case it’s loading <code>readr</code>, a package specifically designed for reading in and writing out a wide range of file formats, including CSVs and TSVs.</p>
<p>When you see a function name, you can usually access documentation about it; remember the <code>help</code> pane I mentioned earlier? If you type the function name into the console, preceded by <code>?</code>, the help pane will pop up with documentation for that function - what it’s used for, what values it accepts, and generally how it works.</p>
<p>So we have our file-reading code. Now let’s read in the file, with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="dt">file =</span> <span class="st">&quot;https://www.ironholds.org/resources/misc/patient_data.csv&quot;</span>)</code></pre></div>
<p>Let’s break down what’s going on in that code, going from right to left. First we have a piece of text - a URL, in fact - in quote marks. The quote marks identify the text as a <code>string</code>; something that R should treat just as text, not as code to be executed. Then we have that URL being associated with “file”, the entire thing wrapped in parentheses, preceded by <code>read_csv</code> which, as we’ve seen from loading the <code>readr</code> package, is a function call.</p>
<p>So what we have is a call to run <code>read_csv</code>, with the “file” argument being that URL - so it’s reading a CSV from that URL! The argument, as the name <code>file</code> suggests, doesn’t have to be a URL; it can also be a file on your local computer.</p>
<p>Then we shift left and run into <code>&lt;-</code>. That’s R’s <em>assignment operator</em>; it assigns the results of whatever code is on the right of the operator, to a name on the left of it (in this case, <code>patient_data</code>). So the code, in plain English, is “read in the CSV at this URL and assign the contents of it to the name <code>patient_data</code>”. If the file was a TSV, the process would look exactly the same; you’d just use <code>read_tsv</code> instead of <code>read_csv</code>.</p>
<p>We call the result (the output of code, tied to a name) an <em>object</em>. You can see the contents of an object just by typing its name into the console, but that shows the entire thing, and this dataset is rather large; instead, let’s use the <code>head</code> function, which just shows the top few rows (the head of the data):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(patient_data)


  year facility_number                  facility type_of_control age_group admitted released
<span class="dv">1</span> <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL, ALAMEDA        District     <span class="dv">10-19</span>       <span class="dv">62</span>        <span class="dv">2</span>
<span class="dv">2</span> <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL, ALAMEDA        District     <span class="dv">20-29</span>      <span class="dv">124</span>       <span class="dv">63</span>
<span class="dv">3</span> <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL, ALAMEDA        District     <span class="dv">30-39</span>      <span class="dv">140</span>       <span class="dv">67</span>
<span class="dv">4</span> <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL, ALAMEDA        District     <span class="dv">40-49</span>      <span class="dv">243</span>      <span class="dv">122</span>
<span class="dv">5</span> <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL, ALAMEDA        District     <span class="dv">50-59</span>      <span class="dv">411</span>      <span class="dv">172</span>
<span class="dv">6</span> <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL, ALAMEDA        District     <span class="dv">60-69</span>      <span class="dv">415</span>      <span class="dv">343</span></code></pre></div>
<p>As you can see, it’s tabular, just like the CSV - columns of values, rows of observations, and row numbers (from 1 to 6). What you’re looking at is a “data frame”, the most common type of object in R: it’s designed to hold tabular data, since tabular data is what most statisticians and data scientists rely on.</p>
<p>We can get a more detailed look at it with the <code>str</code> function (which means “structure” and does exactly what it says on the tin):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(patient_data)

Classes ‘tbl_df’, ‘tbl’ and <span class="st">&#39;data.frame&#39;</span>:<span class="st">   </span><span class="dv">23578</span> obs. of  <span class="dv">7</span> variables:
<span class="st"> </span><span class="er">$</span><span class="st"> </span>year           :<span class="st"> </span>int  <span class="dv">2009</span> <span class="dv">2009</span> <span class="dv">2009</span> <span class="dv">2009</span> <span class="dv">2009</span> <span class="dv">2009</span> <span class="dv">2009</span> <span class="dv">2009</span> <span class="dv">2009</span> <span class="dv">2009</span> ...
 $<span class="st"> </span>facility_number:<span class="st"> </span>chr  <span class="st">&quot;010735&quot;</span> <span class="st">&quot;010735&quot;</span> <span class="st">&quot;010735&quot;</span> <span class="st">&quot;010735&quot;</span> ...
 $<span class="st"> </span>facility       :<span class="st"> </span>chr  <span class="st">&quot;ALAMEDA HOSPITAL, ALAMEDA&quot;</span> <span class="st">&quot;ALAMEDA HOSPITAL, ALAMEDA&quot;</span> <span class="st">&quot;ALAMEDA HOSPITAL, ALAMEDA&quot;</span> <span class="st">&quot;ALAMEDA HOSPITAL, ALAMEDA&quot;</span> ...
 $<span class="st"> </span>type_of_control:<span class="st"> </span>chr  <span class="st">&quot;District&quot;</span> <span class="st">&quot;District&quot;</span> <span class="st">&quot;District&quot;</span> <span class="st">&quot;District&quot;</span> ...
 $<span class="st"> </span>age_group      :<span class="st"> </span>chr  <span class="st">&quot;10-19&quot;</span> <span class="st">&quot;20-29&quot;</span> <span class="st">&quot;30-39&quot;</span> <span class="st">&quot;40-49&quot;</span> ...
 $<span class="st"> </span>admitted       :<span class="st"> </span>int  <span class="dv">62</span> <span class="dv">124</span> <span class="dv">140</span> <span class="dv">243</span> <span class="dv">411</span> <span class="dv">415</span> <span class="dv">486</span> <span class="dv">961</span> <span class="dv">7743</span> <span class="dv">788</span> ...
 $<span class="st"> </span>released       :<span class="st"> </span>int  <span class="dv">2</span> <span class="dv">63</span> <span class="dv">67</span> <span class="dv">122</span> <span class="dv">172</span> <span class="dv">343</span> <span class="dv">7</span> <span class="dv">389</span> <span class="dv">1136</span> <span class="dv">531</span> ...</code></pre></div>
<p>There’s a lot going on here, so let’s break it down:</p>
<ol style="list-style-type: decimal">
<li>First, “classes”; this is analogous to the object type. We don’t have to dig into exactly how the system works (although feel free to ask me about it via email or do further research); the important thing to note is that one of the classes is <code>data.frame</code>, identifying this as, well, a data frame!</li>
<li>We then have “23578 obs. of 7 variables”; there are 23,578 rows, and 7 columns (which, in R, are known as <code>vectors</code> - more on those later). You can get these bits of information distinctly, through the <code>nrow</code> and <code>ncol</code> functions.</li>
<li>We then have a sort of flipped version of the <code>head</code> output - showing each vector, from the first to the last, down. There are the vector names (<code>year</code>, <code>facility_number</code>, <code>facility</code>), examples of the entries in those columns, and then these little strings “int” and “chr”. These represents the “type” of the column - the kind of data it can contain. <code>int</code> vectors contain whole numbers; <code>chr</code> (or “character”) vectors contain strings. Other common types to see are <code>logical</code> (or <code>logi</code>), which contains true and false values, and <code>numeric</code>/<code>num</code> columns, which contain non-whole numbers.</li>
</ol>
<p>So now we have our data read into R. It’s not quite perfect, though; the <code>facility_number</code> vector is meant to be, well, a column of numbers, but according to <code>str</code> it’s actually a character vector. This offers us an opportunity to explore modifying data frames, and switching between types.</p>
<p>One of the reasons data frames are powerful is that you can access, change and use individual vectors, as well as the data frame as a whole; this is done by calling, instead of <code>data_frame_name</code>, <code>data_frame_name$column_name</code>.</p>
<p>Distinctly from that, it is possible to change the type of an object in R (the process is known as <code>coercing</code>), which can be very useful; depending on what you’re doing, you might want to store a value as a different type. Coersion is done with the <code>as</code> functions; <code>as.numeric</code> to turn something into a numeric value, <code>as.integer</code> for an integer, and then <code>as.logical</code> and <code>as.character</code> for those respective types.</p>
<p>Let’s use both techniques now, to clear up that <code>facility_number</code> vector:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_data$facility_number &lt;-<span class="st"> </span><span class="kw">as.integer</span>(patient_data$facility_number)

<span class="kw">str</span>(patient_data)

Classes ‘tbl_df’, ‘tbl’ and <span class="st">&#39;data.frame&#39;</span>:<span class="st">   </span><span class="dv">23578</span> obs. of  <span class="dv">7</span> variables:
<span class="st"> </span><span class="er">$</span><span class="st"> </span>year           :<span class="st"> </span>int  <span class="dv">2009</span> <span class="dv">2009</span> <span class="dv">2009</span> <span class="dv">2009</span> <span class="dv">2009</span> <span class="dv">2009</span> <span class="dv">2009</span> <span class="dv">2009</span> <span class="dv">2009</span> <span class="dv">2009</span> ...
 $<span class="st"> </span>facility_number:<span class="st"> </span>int  <span class="dv">10735</span> <span class="dv">10735</span> <span class="dv">10735</span> <span class="dv">10735</span> <span class="dv">10735</span> <span class="dv">10735</span> <span class="dv">10735</span> <span class="dv">10735</span> <span class="dv">10739</span> <span class="dv">10739</span> ...
 $<span class="st"> </span>facility       :<span class="st"> </span>chr  <span class="st">&quot;ALAMEDA HOSPITAL, ALAMEDA&quot;</span> <span class="st">&quot;ALAMEDA HOSPITAL, ALAMEDA&quot;</span> <span class="st">&quot;ALAMEDA HOSPITAL, ALAMEDA&quot;</span> <span class="st">&quot;ALAMEDA HOSPITAL, ALAMEDA&quot;</span> ...
 $<span class="st"> </span>type_of_control:<span class="st"> </span>chr  <span class="st">&quot;District&quot;</span> <span class="st">&quot;District&quot;</span> <span class="st">&quot;District&quot;</span> <span class="st">&quot;District&quot;</span> ...
 $<span class="st"> </span>age_group      :<span class="st"> </span>chr  <span class="st">&quot;10-19&quot;</span> <span class="st">&quot;20-29&quot;</span> <span class="st">&quot;30-39&quot;</span> <span class="st">&quot;40-49&quot;</span> ...
 $<span class="st"> </span>admitted       :<span class="st"> </span>int  <span class="dv">62</span> <span class="dv">124</span> <span class="dv">140</span> <span class="dv">243</span> <span class="dv">411</span> <span class="dv">415</span> <span class="dv">486</span> <span class="dv">961</span> <span class="dv">7743</span> <span class="dv">788</span> ...
 $<span class="st"> </span>released       :<span class="st"> </span>int  <span class="dv">2</span> <span class="dv">63</span> <span class="dv">67</span> <span class="dv">122</span> <span class="dv">172</span> <span class="dv">343</span> <span class="dv">7</span> <span class="dv">389</span> <span class="dv">1136</span> <span class="dv">531</span> ...</code></pre></div>
<p>As you can see, <code>facility_number</code> is now an integer vector, which lets us (amongst other things) do maths with it if we so choose - tremendously useful.</p>
<p>Vectors are very powerful in their own right, and a useful object type for when you don’t want to be dealing with an entire data frame. They can be created in a couple of ways:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># This creates a vector from scratch, using data in the code:</span>
a_vector &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)

<span class="co"># This creates a vector from a data frame column</span>
patient_data_counts &lt;-<span class="st"> </span>patient_data$count</code></pre></div>
<p>Individual elements of a vector can be accessed using <code>vectorname[n]</code>, where <code>n</code> is the Nth element. So if you want the fifth element from <code>some_vector</code>: <code>some_vector[5]</code>.</p>
<p>We can add new vectors to data frames using a technique similar to how we modified them, and take advantage of a feature of R called “vectorisation”. The easiest way to think about it is Excel-related. You have your Excel spreadsheet, and you create a formula in one cell to add up all the values in that row. You want to do that for every row, so you drag the formula down the column and it copies the formula out, ending up with something like:</p>
<pre><code>A1 + A2
B1 + B2
C1 + C2</code></pre>
<p>Vectorisation is just that - except it’s automated. No dragging and dropping required! Most R functions automatically work on entire vectors of data, and work when you have a vectors on one side but only a single value on the other. Let’s combine that with data frame modification to work out the <em>percentage</em> of the total patients admission number in each row:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_data$percentage &lt;-<span class="st"> </span>(patient_data$admitted /<span class="st"> </span><span class="kw">sum</span>(patient_data$admitted)) *<span class="st"> </span><span class="dv">100</span>

<span class="kw">str</span>(patient_data)

Classes ‘tbl_df’, ‘tbl’ and <span class="st">&#39;data.frame&#39;</span>:<span class="st">   </span><span class="dv">23578</span> obs. of  <span class="dv">8</span> variables:
<span class="st"> </span><span class="er">$</span><span class="st"> </span>year           :<span class="st"> </span>int  <span class="dv">2009</span> <span class="dv">2009</span> <span class="dv">2009</span> <span class="dv">2009</span> <span class="dv">2009</span> <span class="dv">2009</span> <span class="dv">2009</span> <span class="dv">2009</span> <span class="dv">2009</span> <span class="dv">2009</span> ...
 $<span class="st"> </span>facility_number:<span class="st"> </span>int  <span class="dv">10735</span> <span class="dv">10735</span> <span class="dv">10735</span> <span class="dv">10735</span> <span class="dv">10735</span> <span class="dv">10735</span> <span class="dv">10735</span> <span class="dv">10735</span> <span class="dv">10739</span> <span class="dv">10739</span> ...
 $<span class="st"> </span>facility       :<span class="st"> </span>chr  <span class="st">&quot;ALAMEDA HOSPITAL, ALAMEDA&quot;</span> <span class="st">&quot;ALAMEDA HOSPITAL, ALAMEDA&quot;</span> <span class="st">&quot;ALAMEDA HOSPITAL, ALAMEDA&quot;</span> <span class="st">&quot;ALAMEDA HOSPITAL, ALAMEDA&quot;</span> ...
 $<span class="st"> </span>type_of_control:<span class="st"> </span>chr  <span class="st">&quot;District&quot;</span> <span class="st">&quot;District&quot;</span> <span class="st">&quot;District&quot;</span> <span class="st">&quot;District&quot;</span> ...
 $<span class="st"> </span>age_group      :<span class="st"> </span>chr  <span class="st">&quot;10-19&quot;</span> <span class="st">&quot;20-29&quot;</span> <span class="st">&quot;30-39&quot;</span> <span class="st">&quot;40-49&quot;</span> ...
 $<span class="st"> </span>admitted       :<span class="st"> </span>int  <span class="dv">62</span> <span class="dv">124</span> <span class="dv">140</span> <span class="dv">243</span> <span class="dv">411</span> <span class="dv">415</span> <span class="dv">486</span> <span class="dv">961</span> <span class="dv">7743</span> <span class="dv">788</span> ...
 $<span class="st"> </span>released       :<span class="st"> </span>int  <span class="dv">2</span> <span class="dv">63</span> <span class="dv">67</span> <span class="dv">122</span> <span class="dv">172</span> <span class="dv">343</span> <span class="dv">7</span> <span class="dv">389</span> <span class="dv">1136</span> <span class="dv">531</span> ...
 $<span class="st"> </span>percentage     :<span class="st"> </span>num  <span class="fl">0.000266</span> <span class="fl">0.000532</span> <span class="fl">0.000601</span> <span class="fl">0.001043</span> <span class="fl">0.001764</span> ...</code></pre></div>
<p>No drag and drop necessary; the <code>patient_data</code> data frame has a new column, <code>percentage</code>, which contains (for each row) the <code>admitted</code> count divided by the total count of admitted patients for the entire dataset, which we retrieved with <code>sum</code>.</p>
<p>So we now know:</p>
<ol style="list-style-type: decimal">
<li>How to read data into R from CSV files (and TSV files!);</li>
<li>How to examine the structure of an R object;</li>
<li>How do access individual columns of a data frame;</li>
<li>How to modify those columns, and create new ones;</li>
<li>How vectors work;</li>
<li>How vectorisation works.</li>
</ol>
<p>Let’s move on to everyone’s favourite business data format: Microsoft Excel!</p>
</div>
<div id="excel" class="section level2">
<h2><span class="header-section-number">4.2</span> Excel</h2>
<p>Microsoft Excel is widely used in a business context, and correspondingly the data it outputs (<code>.xls</code> and <code>.xlsx</code> files) are widely distributed. We should learn how to read them into R, which is a big step in shifting away from Excel-based workflows and ensures that you can consume data from more traditional sources without running into format incompatibilities.</p>
<p>For this we’ll need another R package, <code>readxl</code>, which does just that - reads in Excel files. Let’s load it and read in a file that the package ships with (which we can find with the <code>system.file</code> function):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readxl)
excel_data &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="dt">path =</span> <span class="kw">system.file</span>(<span class="st">&quot;extdata/datasets.xlsx&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;readxl&quot;</span>))
<span class="kw">head</span>(excel_data)

  Sepal.Length Sepal.Width Petal.Length Petal.Width Species
<span class="dv">1</span>          <span class="fl">5.1</span>         <span class="fl">3.5</span>          <span class="fl">1.4</span>         <span class="fl">0.2</span>  setosa
<span class="dv">2</span>          <span class="fl">4.9</span>         <span class="fl">3.0</span>          <span class="fl">1.4</span>         <span class="fl">0.2</span>  setosa
<span class="dv">3</span>          <span class="fl">4.7</span>         <span class="fl">3.2</span>          <span class="fl">1.3</span>         <span class="fl">0.2</span>  setosa
<span class="dv">4</span>          <span class="fl">4.6</span>         <span class="fl">3.1</span>          <span class="fl">1.5</span>         <span class="fl">0.2</span>  setosa
<span class="dv">5</span>          <span class="fl">5.0</span>         <span class="fl">3.6</span>          <span class="fl">1.4</span>         <span class="fl">0.2</span>  setosa
<span class="dv">6</span>          <span class="fl">5.4</span>         <span class="fl">3.9</span>          <span class="fl">1.7</span>         <span class="fl">0.4</span>  setosa</code></pre></div>
<p>It’s another data frame - as expected, since excel spreadsheets are tabular just like CSV files are. One important note - Excel spreadsheets can contain multiple sheets, <em>each</em> of them a table. How do we handle that?</p>
<p>If you look at the documentation for <code>read_excel</code>, you’ll see a <code>sheet</code> argument, which you can use to specify which sheet to read in. The <code>excel_sheets</code> function, meanwhile, gets you how many sheets an Excel file has. So we can combine them to work out how many sheets we’re looking at, and then read in that many.</p>
<p>But what happens when you have to write code that reads in a variety of different files, some with different numbers of sheets? How do we write code that doesn’t mind how many sheets there are? How do we store the results of that code?</p>
<p>A few new concepts and pieces of R, for this question. First-off is how we’re going to store the results. We’re looking at an unknown number of sheets, which means an unknown number of data frames. Luckily, data frames can be stored as components of a single object, just like vectors are components of data frames. That means instead of having an unknown number of objects, we just have one.</p>
<p>For that kind of storage, we’re going to introduce a new object type in R: <code>lists</code>. Lists can have any length you want, and contain pretty much any object you want, too, which makes them extremely powerful. You can construct and use them with, or without names.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># A list without names</span>
nameless_list &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">2</span>, <span class="dv">3</span>)

<span class="co"># A list with names</span>
named_list &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">first_object =</span> <span class="dv">2</span>, <span class="dt">second_object =</span> <span class="dv">3</span>)</code></pre></div>
<p>The difference is how you get objects inside the list, or change those objects: if the list has names, you can use the <code>$</code> character we use with data frame contents. If it doesn’t, you have to use indices - getting the Nth element of the object by pointing to <code>[[N]]</code>. Taking the list examples we created above:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nameless_list[[<span class="dv">1</span>]]
[<span class="dv">1</span>] <span class="dv">2</span>

named_list$first_object
[<span class="dv">1</span>] <span class="dv">2</span></code></pre></div>
<p>So now we know how to store the results. But how do we get them?</p>
<p>First, we need to have a way of automatically knowing how many sheets there are. We can do that with another <code>readxl</code> function, <code>excel_sheets</code>, which lists all the sheets in an Excel file:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sheet_names &lt;-<span class="st"> </span><span class="kw">excel_sheets</span>(<span class="dt">path =</span> <span class="kw">system.file</span>(<span class="st">&quot;extdata/datasets.xlsx&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;readxl&quot;</span>))
sheet_names

[<span class="dv">1</span>] <span class="st">&quot;iris&quot;</span>     <span class="st">&quot;mtcars&quot;</span>   <span class="st">&quot;chickwts&quot;</span> <span class="st">&quot;quakes&quot;</span></code></pre></div>
<p>Then we need a way of taking that vector of sheet names, and, for each one, reading in that sheet, and storing all the results in a list. The answer is the <code>lapply</code> function.</p>
<p><code>lapply</code> takes a list (or vector), <code>X</code> and, for each element of <code>X</code>, performs a specified operation using it. The results of each operation on each element is then returned in a list. Perfect! So what we want is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sheet_names &lt;-<span class="st"> </span><span class="kw">excel_sheets</span>(<span class="dt">path =</span> <span class="kw">system.file</span>(<span class="st">&quot;extdata/datasets.xlsx&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;readxl&quot;</span>))
all_sheets &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="dt">X =</span> sheet_names, <span class="dt">FUN =</span> read_excel,
                     <span class="dt">path =</span> <span class="kw">system.file</span>(<span class="st">&quot;extdata/datasets.xlsx&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;readxl&quot;</span>))</code></pre></div>
<p>If you run <code>str</code> on the results of that, what you <em>should</em> see is that <code>all_sheets</code> is a list, containing 4 data frames, all of which contain a pile of columns and rows just like our example at the beginning. These data frames can be extracted using the indices operation; <code>all_sheets[[1]]</code> gets you the first sheet, and so on, and so forth.</p>
<p>So now we’ve learned how to read in Excel files. We’ve also learned:</p>
<ol style="list-style-type: decimal">
<li>What lists are (and how they can be used to store a variety of objects);</li>
<li>How to apply a function to each element of a list (or vector);</li>
<li>How to get the results of that application.</li>
</ol>
</div>
<div id="other-files" class="section level2">
<h2><span class="header-section-number">4.3</span> Other files</h2>
<p>There are a few other file types you might encounter. One of the most common is <em>tab</em>-separated value files (TSVs); another, less common, is fixed-width files, where there’s an arbitrary amount of space between elements on each row to make sure every entry is the same width.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tutorial-format.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="reading-data-from-databases.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
