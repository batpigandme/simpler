<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Starting Out with R and Shiny</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="This is a booklike set of lesson plans on starting out with R, with the goal of writing Shiny dashboards.">
  <meta name="generator" content="bookdown 0.0.72 and GitBook 2.6.7">

  <meta property="og:title" content="Starting Out with R and Shiny" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a booklike set of lesson plans on starting out with R, with the goal of writing Shiny dashboards." />
  <meta name="github-repo" content="ironholds/simpler" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Starting Out with R and Shiny" />
  
  <meta name="twitter:description" content="This is a booklike set of lesson plans on starting out with R, with the goal of writing Shiny dashboards." />
  

<meta name="author" content="Oliver Keyes">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="exploratory-data-analysis.html">
<link rel="next" href="building-your-first-app.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preamble</a></li>
<li class="chapter" data-level="1" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i><b>1</b> Introduction to R</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#a-brief-history-of-splines"><i class="fa fa-check"></i><b>1.1</b> A brief history of splines</a></li>
<li class="chapter" data-level="1.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#why-r-succeeds"><i class="fa fa-check"></i><b>1.2</b> Why R succeeds</a></li>
<li class="chapter" data-level="1.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#the-r-community"><i class="fa fa-check"></i><b>1.3</b> The R community</a></li>
<li class="chapter" data-level="1.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-installation"><i class="fa fa-check"></i><b>1.4</b> R installation</a></li>
<li class="chapter" data-level="1.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#using-rstudio"><i class="fa fa-check"></i><b>1.5</b> Using RStudio</a></li>
<li class="chapter" data-level="1.6" data-path="introduction-to-r.html"><a href="introduction-to-r.html#tutorial-format"><i class="fa fa-check"></i><b>1.6</b> Tutorial format</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-import-and-export.html"><a href="data-import-and-export.html"><i class="fa fa-check"></i><b>2</b> Data Import and Export</a><ul>
<li class="chapter" data-level="2.1" data-path="data-import-and-export.html"><a href="data-import-and-export.html#importing-from-csvs"><i class="fa fa-check"></i><b>2.1</b> Importing from CSVs</a></li>
<li class="chapter" data-level="2.2" data-path="data-import-and-export.html"><a href="data-import-and-export.html#importing-excel-spreadsheets"><i class="fa fa-check"></i><b>2.2</b> Importing Excel spreadsheets</a></li>
<li class="chapter" data-level="2.3" data-path="data-import-and-export.html"><a href="data-import-and-export.html#other-files"><i class="fa fa-check"></i><b>2.3</b> Other files</a></li>
<li class="chapter" data-level="2.4" data-path="data-import-and-export.html"><a href="data-import-and-export.html#database-import"><i class="fa fa-check"></i><b>2.4</b> Database import</a></li>
<li class="chapter" data-level="2.5" data-path="data-import-and-export.html"><a href="data-import-and-export.html#exporting-data"><i class="fa fa-check"></i><b>2.5</b> Exporting data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>3</b> Exploratory Data Analysis</a><ul>
<li class="chapter" data-level="3.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#dataset-metadata"><i class="fa fa-check"></i><b>3.1</b> Dataset metadata</a></li>
<li class="chapter" data-level="3.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#missing-and-duplicate-values"><i class="fa fa-check"></i><b>3.2</b> Missing and duplicate values</a></li>
<li class="chapter" data-level="3.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#examining-values"><i class="fa fa-check"></i><b>3.3</b> Examining values</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cleaning-and-manipulating-data.html"><a href="cleaning-and-manipulating-data.html"><i class="fa fa-check"></i><b>4</b> Cleaning and manipulating data</a><ul>
<li class="chapter" data-level="4.1" data-path="cleaning-and-manipulating-data.html"><a href="cleaning-and-manipulating-data.html#reshaping-data"><i class="fa fa-check"></i><b>4.1</b> Reshaping data</a></li>
<li class="chapter" data-level="4.2" data-path="cleaning-and-manipulating-data.html"><a href="cleaning-and-manipulating-data.html#data-manipulation"><i class="fa fa-check"></i><b>4.2</b> Data manipulation</a></li>
<li class="chapter" data-level="4.3" data-path="cleaning-and-manipulating-data.html"><a href="cleaning-and-manipulating-data.html#text-cleaning"><i class="fa fa-check"></i><b>4.3</b> Text-cleaning</a></li>
<li class="chapter" data-level="4.4" data-path="cleaning-and-manipulating-data.html"><a href="cleaning-and-manipulating-data.html#dates-and-times"><i class="fa fa-check"></i><b>4.4</b> Dates and times</a></li>
</ul></li>
<li class="part"><span><b>Shiny</b></span></li>
<li class="chapter" data-level="5" data-path="building-your-first-app.html"><a href="building-your-first-app.html"><i class="fa fa-check"></i><b>5</b> Building your first app</a></li>
<li class="chapter" data-level="6" data-path="user-interface-design.html"><a href="user-interface-design.html"><i class="fa fa-check"></i><b>6</b> User Interface design</a></li>
<li class="chapter" data-level="7" data-path="custom-inputs-and-outputs.html"><a href="custom-inputs-and-outputs.html"><i class="fa fa-check"></i><b>7</b> Custom inputs and outputs</a></li>
<li class="chapter" data-level="8" data-path="reactive-expressions.html"><a href="reactive-expressions.html"><i class="fa fa-check"></i><b>8</b> Reactive expressions</a></li>
<li class="chapter" data-level="9" data-path="shiny-dashboarding.html"><a href="shiny-dashboarding.html"><i class="fa fa-check"></i><b>9</b> Shiny dashboarding</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Starting Out with R and Shiny</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cleaning-and-manipulating-data" class="section level1">
<h1><span class="header-section-number">4</span> Cleaning and manipulating data</h1>
<p>So we’ve imported our data. From a database, from an Excel file, from a CSV - wherever it came from, we have it. We’ve even looked through it to see if there’s any interesting nastiness. Then what?</p>
<p>The answer is usually data cleaning. Exploratory analysis is great for getting the low-hanging fruit in imperfect data, and for understanding where the thornier problems lie, but we then have to clean <em>up</em> those thorny problems. That’s where manipulating and cleaning data comes in.</p>
<div id="reshaping-data" class="section level2">
<h2><span class="header-section-number">4.1</span> Reshaping data</h2>
<p>One essential part of cleaning is <em>reshaping</em> your data’s structure. Sometimes as researchers we are lucky enough to have data that looks exactly like what we want. Every row is a single observation. Every column contains one, and just one, thing we care about. This is referred to as <em>tidy data</em> (a concept you can read more about <a href="http://vita.had.co.nz/papers/tidy-data.html">here</a>).</p>
<p>We’ll use the original patient dataset as an example. Let’s take a look at it:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">patient_data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="dt">file =</span> <span class="st">&quot;https://www.ironholds.org/resources/misc/patient_data.csv&quot;</span>)
<span class="kw">head</span>(patient_data)

  year facility_number                  facility type_of_control age_group admitted released
<span class="dv">1</span> <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL, ALAMEDA        District     <span class="dv">10-19</span>       <span class="dv">62</span>        <span class="dv">2</span>
<span class="dv">2</span> <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL, ALAMEDA        District     <span class="dv">20-29</span>      <span class="dv">124</span>       <span class="dv">63</span>
<span class="dv">3</span> <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL, ALAMEDA        District     <span class="dv">30-39</span>      <span class="dv">140</span>       <span class="dv">67</span>
<span class="dv">4</span> <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL, ALAMEDA        District     <span class="dv">40-49</span>      <span class="dv">243</span>      <span class="dv">122</span>
<span class="dv">5</span> <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL, ALAMEDA        District     <span class="dv">50-59</span>      <span class="dv">411</span>      <span class="dv">172</span>
<span class="dv">6</span> <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL, ALAMEDA        District     <span class="dv">60-69</span>      <span class="dv">415</span>      <span class="dv">343</span></code></pre></div>
<p>There are a few ways in which this data is ‘untidy’. First-off, the facility and facility <em>location</em> are in the same column - we might want to have them as different fields. Second, we’ve got multiple types of data (patient admissions, and patient releases) in different columns. This is good for some operations, like calculating percentages, but can be a tremendous pain with others. We may need to tidy the data, perform operations on it, untidy it for others, and then back again.</p>
<p>So we want to be able to split a column, merge patient admissions and patient releases into one key-value structure, and learn how to un-merge it just in case we have to. We can do all of these with the <code>tidyr</code> package.</p>
<p>First: column-splitting. We’ve got that <code>facility</code> field, containing both the facility name and location, and we want two columns (<code>facility_name</code> and <code>facility_location</code>). For that we can use the <code>separate</code> function from <code>tidyr</code>, which does just that: separates the contents of a specified column, based on a user-defined separator, into multiple new columns (with user-specified names). Let’s use it now:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyr)

split_data &lt;-<span class="st"> </span><span class="kw">separate</span>(<span class="dt">data =</span> patient_data, <span class="dt">col =</span> facility, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;facility_name&quot;</span>, <span class="st">&quot;facility_location&quot;</span>),
                       <span class="dt">sep =</span> <span class="st">&quot;, &quot;</span>)

<span class="kw">head</span>(split_data)

   year facility_number    facility_name facility_location type_of_control age_group admitted released
  &lt;int&gt;<span class="st">           </span><span class="er">&lt;</span>chr&gt;<span class="st">            </span><span class="er">&lt;</span>chr&gt;<span class="st">             </span><span class="er">&lt;</span>chr&gt;<span class="st">           </span><span class="er">&lt;</span>chr&gt;<span class="st">     </span><span class="er">&lt;</span>chr&gt;<span class="st">    </span><span class="er">&lt;</span>int&gt;<span class="st">    </span><span class="er">&lt;</span>int&gt;
<span class="dv">1</span>  <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL           ALAMEDA        District     <span class="dv">10-19</span>       <span class="dv">62</span>        <span class="dv">2</span>
<span class="dv">2</span>  <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL           ALAMEDA        District     <span class="dv">20-29</span>      <span class="dv">124</span>       <span class="dv">63</span>
<span class="dv">3</span>  <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL           ALAMEDA        District     <span class="dv">30-39</span>      <span class="dv">140</span>       <span class="dv">67</span>
<span class="dv">4</span>  <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL           ALAMEDA        District     <span class="dv">40-49</span>      <span class="dv">243</span>      <span class="dv">122</span>
<span class="dv">5</span>  <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL           ALAMEDA        District     <span class="dv">50-59</span>      <span class="dv">411</span>      <span class="dv">172</span>
<span class="dv">6</span>  <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL           ALAMEDA        District     <span class="dv">60-69</span>      <span class="dv">415</span>      <span class="dv">343</span></code></pre></div>
<p>We’ve split <code>facility</code> into <code>facility_name</code> and <code>facility_location</code>. Pretty neat! Still leaves us with what to do about the multiple value columns, though. The answer comes in the form of <code>gather</code>, another tidyr function, which takes a data frame, the names to give the key and value columns, and columns to treat as <code>id</code> columns that aren’t touched. It then splits the rest:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gathered_data &lt;-<span class="st"> </span><span class="kw">gather</span>(<span class="dt">data =</span> split_data, <span class="dt">key =</span> <span class="st">&quot;type&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;count&quot;</span>, admitted, released)

<span class="kw">head</span>(gathered_data)
   year facility_number    facility_name facility_location type_of_control age_group     type count
  &lt;int&gt;<span class="st">           </span><span class="er">&lt;</span>chr&gt;<span class="st">            </span><span class="er">&lt;</span>chr&gt;<span class="st">             </span><span class="er">&lt;</span>chr&gt;<span class="st">           </span><span class="er">&lt;</span>chr&gt;<span class="st">     </span><span class="er">&lt;</span>chr&gt;<span class="st">    </span><span class="er">&lt;</span>chr&gt;<span class="st"> </span><span class="er">&lt;</span>int&gt;
<span class="dv">1</span>  <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL           ALAMEDA        District     <span class="dv">10-19</span> admitted    <span class="dv">62</span>
<span class="dv">2</span>  <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL           ALAMEDA        District     <span class="dv">20-29</span> admitted   <span class="dv">124</span>
<span class="dv">3</span>  <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL           ALAMEDA        District     <span class="dv">30-39</span> admitted   <span class="dv">140</span>
<span class="dv">4</span>  <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL           ALAMEDA        District     <span class="dv">40-49</span> admitted   <span class="dv">243</span>
<span class="dv">5</span>  <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL           ALAMEDA        District     <span class="dv">50-59</span> admitted   <span class="dv">411</span>
<span class="dv">6</span>  <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL           ALAMEDA        District     <span class="dv">60-69</span> admitted   <span class="dv">415</span></code></pre></div>
<p>If we want to reverse that operation, we can use <code>spread</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">spread_data &lt;-<span class="st"> </span><span class="kw">spread</span>(<span class="dt">data =</span> gathered_data, <span class="dt">key =</span> type, <span class="dt">value =</span> count)

<span class="kw">head</span>(spread_data)

   year facility_number    facility_name facility_location type_of_control age_group admitted released
  &lt;int&gt;<span class="st">           </span><span class="er">&lt;</span>chr&gt;<span class="st">            </span><span class="er">&lt;</span>chr&gt;<span class="st">             </span><span class="er">&lt;</span>chr&gt;<span class="st">           </span><span class="er">&lt;</span>chr&gt;<span class="st">     </span><span class="er">&lt;</span>chr&gt;<span class="st">    </span><span class="er">&lt;</span>int&gt;<span class="st">    </span><span class="er">&lt;</span>int&gt;
<span class="dv">1</span>  <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL           ALAMEDA        District     <span class="dv">10-19</span>       <span class="dv">62</span>        <span class="dv">2</span>
<span class="dv">2</span>  <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL           ALAMEDA        District     <span class="dv">20-29</span>      <span class="dv">124</span>       <span class="dv">63</span>
<span class="dv">3</span>  <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL           ALAMEDA        District     <span class="dv">30-39</span>      <span class="dv">140</span>       <span class="dv">67</span>
<span class="dv">4</span>  <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL           ALAMEDA        District     <span class="dv">40-49</span>      <span class="dv">243</span>      <span class="dv">122</span>
<span class="dv">5</span>  <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL           ALAMEDA        District     <span class="dv">50-59</span>      <span class="dv">411</span>      <span class="dv">172</span>
<span class="dv">6</span>  <span class="dv">2009</span>          <span class="dv">010735</span> ALAMEDA HOSPITAL           ALAMEDA        District     <span class="dv">60-69</span>      <span class="dv">415</span>      <span class="dv">343</span></code></pre></div>
<p>…and at that point, we’re right back where we started.</p>
</div>
<div id="data-manipulation" class="section level2">
<h2><span class="header-section-number">4.2</span> Data manipulation</h2>
<p>Beyond tidying data, another common need is to aggregate it. Raw data, split by as many variables as possible, gives us the widest possible amount of information, but that doesn’t mean it’s easy to visualise or understand (<code>patient_data</code> has 23,578 observations, for example. Nobody wants a 23,000 point graphic).</p>
<p>Data manipulation is the practice of reshaping, aggregating or splitting data to make it easier to use for a particular task. If you’re exploring data, that might look like aggregating it at a very high level to get a general feel for what things look like. If you’re visualising it, that might look like calculating particular metrics for entire groups of observations, and getting a data frame out at the end you can turn into a graph. In these cases, and a wide range of other cases, the answer is another R package: <code>dplyr</code>.</p>
<p><code>dplyr</code> provides a “grammar” of data manipulation: a set of functions that can be strung together into almost a sentence that describes what’s being done to the data. For example, if we wanted to summarise, for each facility, the number of admitted patients in the 10-19 age group, we would <code>filter</code> the dataset to 10-19, <code>group</code> the entries by facility name, and <code>summarize</code> the dataset to get the mean.</p>
<p>This language-like construct is aided by a new operator that we’ll introduce: <code>%&gt;%</code>, or the “pipe” operator. Normally, R consists of a series of statements, assigning the results to objects, and passing those objects to <em>new</em> statements, and so on:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">start_data &lt;-<span class="st"> &quot;foo&quot;</span>
result_of_first_step &lt;-<span class="st"> </span><span class="kw">do_thing</span>(start_data)
result_of_second_step &lt;-<span class="st"> </span><span class="kw">do_second_thing</span>(result_of_first_step)
final_result &lt;-<span class="st"> </span><span class="kw">do_third_thing</span>(result_of_second_step)</code></pre></div>
<p>The pipe operator lets us “chain” operations together; instead of assigning to an object between function calls, you can forward the results of each function call to the first argument in the next function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">start_data &lt;-<span class="st"> &quot;foo&quot;</span>
final_result &lt;-<span class="st"> </span><span class="kw">do_thing</span>(start_data) %&gt;%
<span class="st">                  </span>do_second_thing %&gt;%
<span class="st">                  </span>do_third_thing</code></pre></div>
<p>The code is much cleaner (and somewhat faster to run!), and when you add the “language”-like aspect of dplyr and tidyr in, it becomes almost a sentence. It’s also much easier to modify; if you want to add a new thing between the second and third things, you can just add it, and don’t have to worry about changing names and assignments and all the rest.</p>
<p>Let’s demonstrate by taking the patient data dataset, and then working out the average number of 10-19 year olds admitted to facilities a year:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">facility_admission_average &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="dt">file =</span> <span class="st">&quot;https://www.ironholds.org/resources/misc/patient_data.csv&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">filter</span>(age_group ==<span class="st"> &quot;10-19&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(year) %&gt;%
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">admission_average =</span> <span class="kw">mean</span>(admitted))

<span class="kw">head</span>(facility_admission_average)

   year admission_average
  &lt;int&gt;<span class="st">             </span><span class="er">&lt;</span>dbl&gt;
<span class="dv">1</span>  <span class="dv">2009</span>          <span class="fl">418.5859</span>
<span class="dv">2</span>  <span class="dv">2010</span>          <span class="fl">407.1007</span>
<span class="dv">3</span>  <span class="dv">2011</span>          <span class="fl">390.5659</span>
<span class="dv">4</span>  <span class="dv">2012</span>          <span class="fl">378.8952</span>
<span class="dv">5</span>  <span class="dv">2013</span>          <span class="fl">356.8860</span>
<span class="dv">6</span>  <span class="dv">2014</span>          <span class="fl">350.0652</span></code></pre></div>
<p>And just like that we’ve gone from raw data to averaged hospital admissions, by year, for a particular age group - although we probably should have rounded the results. I’m not sure if you can admit half a patient; certainly not without a rather grim prognosis and, in the event that they survive, medical bills that cost an arm and a leg.</p>
<p>Dad jokes aside, when you combine <code>tidyr</code>, <code>dplyr</code> and the pipe operator, you can write long pieces of data cleaning and manipulation code that just flow naturally: they’re practically (gasp) human-readable! Both of those packages can do a lot more, and if you’re interested in a more dedicated exploration of their features, I thoroughly recommend Bradley Boehmke’s <a href="https://rpubs.com/bradleyboehmke/data_wrangling">data wrangling guide</a>.</p>
</div>
<div id="text-cleaning" class="section level2">
<h2><span class="header-section-number">4.3</span> Text-cleaning</h2>
<p>Numbers are easy, because numbers are, well, just numbers. Text is a lot harder, because text tends to be the result of human input, and humans introduce typos. The result can throw off your data analysis - you might be dealing with information about two groups of patients, “admitted” and “released”, but the data could very well also include “ADMITTED”, and “relesad” (which is, to be fair, really sad).</p>
<p>Summarising the data won’t work, since it’ll be grouping by values that are actually totally meaningless, graphing will be a tremendous pain for similar reasons, and eventually you’ll be sat there manually going through and clearing up the information, which will take slightly longer than the amount of time you have before your manager sends you the next dataset.</p>
<p>So instead, let’s learn how to automatically clean up text in R. For this we’ll need the <code>stringr</code> package, which is a package that lets you (as the name suggests) manipulate strings.</p>
<p>If we look at the <code>patient_data</code> dataset, there are a few things that make the text awkward. For one thing, all the strings are IN ALL CAPS. Really we want them to be formatted like proper nouns (since that’s what they are). We can use <code>stri_to_title</code> to do that:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(stringr)
patient_data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="dt">file =</span> <span class="st">&quot;https://www.ironholds.org/resources/misc/patient_data.csv&quot;</span>)
patient_data$facility &lt;-<span class="st"> </span><span class="kw">str_to_title</span>(patient_data$facility)

   year facility_number                  facility type_of_control age_group admitted released
  &lt;int&gt;<span class="st">           </span><span class="er">&lt;</span>chr&gt;<span class="st">                     </span><span class="er">&lt;</span>chr&gt;<span class="st">           </span><span class="er">&lt;</span>chr&gt;<span class="st">     </span><span class="er">&lt;</span>chr&gt;<span class="st">    </span><span class="er">&lt;</span>int&gt;<span class="st">    </span><span class="er">&lt;</span>int&gt;
<span class="dv">1</span>  <span class="dv">2009</span>          <span class="dv">010735</span> Alameda Hospital, Alameda        District     <span class="dv">10-19</span>       <span class="dv">62</span>        <span class="dv">2</span>
<span class="dv">2</span>  <span class="dv">2009</span>          <span class="dv">010735</span> Alameda Hospital, Alameda        District     <span class="dv">20-29</span>      <span class="dv">124</span>       <span class="dv">63</span>
<span class="dv">3</span>  <span class="dv">2009</span>          <span class="dv">010735</span> Alameda Hospital, Alameda        District     <span class="dv">30-39</span>      <span class="dv">140</span>       <span class="dv">67</span>
<span class="dv">4</span>  <span class="dv">2009</span>          <span class="dv">010735</span> Alameda Hospital, Alameda        District     <span class="dv">40-49</span>      <span class="dv">243</span>      <span class="dv">122</span>
<span class="dv">5</span>  <span class="dv">2009</span>          <span class="dv">010735</span> Alameda Hospital, Alameda        District     <span class="dv">50-59</span>      <span class="dv">411</span>      <span class="dv">172</span>
<span class="dv">6</span>  <span class="dv">2009</span>          <span class="dv">010735</span> Alameda Hospital, Alameda        District     <span class="dv">60-69</span>      <span class="dv">415</span>      <span class="dv">343</span></code></pre></div>
<p>Much cleaner! And <code>stringr</code> has a lot of other functions we can apply, too, including:</p>
<ol style="list-style-type: decimal">
<li><code>str_trim</code> for getting rid of extraneous whitespace (<code>&quot;foo&quot;</code> and <code>&quot;foo &quot;</code> are the same thing, but R doesn’t know that);</li>
<li><code>str_order</code>, for sorting a vector of strings;</li>
<li>Applying regular expressions to identify matches (<code>str_match</code>), replace matches (<code>str_replace</code>) or extract them (<code>str_extract</code>). Regular expressions are discussed <a href="https://cran.r-project.org/web/packages/stringr/vignettes/stringr.html">here</a> and pretty complex, so may require further reading to dig into and understand.</li>
</ol>
</div>
<div id="dates-and-times" class="section level2">
<h2><span class="header-section-number">4.4</span> Dates and times</h2>
<p>Although it’s not relevant for <em>this</em> dataset, dates and times commonly crop up as vector types in R. They’re important - if you have longitudinal data, you rely on dates or date-times to segment your data. Time-series data, even moreso!</p>
<p>While base R has some functions for handling dates and times, they’re not particularly user-friendly and are mostly useful in emergencies. Still, sometimes you have an emergency, so let’s go through them.</p>
<p>The big one is <code>strptime</code>, which lets you turn arbitrary(ish) dates and times, formatted as a string, into a proper date or datetime object. All it needs is a string, and a format for that string, and it goes off and does its thing. That format can feature full or abbreviated month names, or month numbers, or 12-hour time, or 24-hour time - anything. Check out the documentation at <code>?strptime</code> to see the full list.</p>
<p>Let’s demonstrate with the most awkward possible date-time I can imagine, and take it from a string to a date-time to just a date.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 7 March 2016, at 9pm, 32 minutes and 51 seconds</span>
awkward_datetime &lt;-<span class="st"> &quot;16-Mar/07:09-32-51 pm&quot;</span>
datetime &lt;-<span class="st"> </span><span class="kw">strptime</span>(<span class="dt">x =</span> awkward_datetime, <span class="dt">format =</span> <span class="st">&quot;%y-%b/%d:%I-%M-%S %p&quot;</span>)
<span class="kw">str</span>(datetime)

POSIXlt[<span class="dv">1</span>:<span class="dv">1</span>], format:<span class="st"> &quot;2016-03-07 21:32:51&quot;</span>
  
<span class="co"># That&#39;s a date/time (POSIXlt and/or POSIXct). To turn it into a date...</span>
  
date &lt;-<span class="st"> </span><span class="kw">as.Date</span>(datetime)
<span class="kw">str</span>(date)

Date[<span class="dv">1</span>:<span class="dv">1</span>], format:<span class="st"> &quot;2016-03-07&quot;</span></code></pre></div>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="exploratory-data-analysis.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="building-your-first-app.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
